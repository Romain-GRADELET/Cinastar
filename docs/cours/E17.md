# E17

## challenge Event : MaintenanceSubcriber

[Listener vs subscriber](https://symfony.com/doc/5.4/event_dispatcher.html#listeners-or-subscribers)

Subscriber se suffit √† lui m√™me, tout en un

Listener doit √™tre configur√© dans services.yaml

### notre subscriber

Objectif : afficher un message d'alerte sur toutes les pages

Comment mettre du html sur toutes les pages sans passer par twig ?

Pour afficher quelque chose dans toutes les pages, on peut d'inspirer de ce qui [est fait pour 'injecter' la toolbar de profiler.](https://github.com/symfony/web-profiler-bundle/blob/c779222d5a87b7d947e56ac09b02adb34cf8b610/EventListener/WebDebugToolbarListener.php#L137)

On remarque de suite que c'est un [KernelEvent](https://github.com/symfony/web-profiler-bundle/blob/c779222d5a87b7d947e56ac09b02adb34cf8b610/EventListener/WebDebugToolbarListener.php#L162)

Chouette, on sait faire les subscriber. üòç

```bash
bin/console make:subscriber
```

On choisit `Kernel.response` comme on l'a vu dans le code de la barre de profiler.

Mais ensuite ü§î ?
le code de la barre de profiler n'est pas tr√®s explicite üòÖ

R√©fl√©chissons, on est sur l'event `response`, on a donc acc√®s √† la r√©ponse HTML juste avant qu'elle soit envoy√©e.
Si on modifiait le contenu du HTML ? un peu comme en JS on manipule le DOM.

Pour √ßa on veut obtenir quoi ?
une balise `<div class="alert alert-danger m-3">Maintenance pr√©vue jeudi 25 mai √† 17h00</div>` mais o√π ?

C'est subjectif, mais choissisons un endroit visible ü§ì, disons juste apr√®s la `<nav>`

On va donc rechercher la `nav` dans le contenu de la page, que l'on obtient avec le `ResponseEvent` pass√© en param√®tre.

On y ins√®re notre message juste apr√®s.

```php
// la r√©ponse HTTP
$response = $event->getResponse();
// le contenu HTML
$content = $response->getContent();
// On ajoute le code de la banni√®re apr√®s la balise nav du contenu HTML
$newHtml = str_replace(
    // Qu'est-ce qu'on cherche ?
    '</nav>',
    // Par quoi on remplace ?
    '</nav><div class="alert alert-danger m-3">Maintenance pr√©vue mardi 10 janvier √† 17h00</div>',
    // Dans quelle chaine ?
    $content
);
// On assigne le nouveau contenu √† la r√©ponse
$response->setContent($newHtml);

// /!\ Nul besoin de retourner quoique ce soit ou d'appeler une m√©thode sp√©cifique
// l'objet $reponse a √©t√© manipul√© directement et sera envoy√© par le Kernel
```

[doc](https://symfony.com/doc/5.4/event_dispatcher.html#creating-an-event-subscriber)

## API : GET

## API : POST/PUT/PATCH

## API : DELETE
