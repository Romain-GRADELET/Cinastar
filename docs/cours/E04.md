# E04

## session

la session est li√© √† la requete, on devra utiliser l'objet Request fournit par Symfony

```php
public function method(Request $request)
{
    $session = $resquest->getSession();
}
```

dans la session on peut stocker des informations de tout types : tableau, objet ...

```php
$session->set("cle_unique", $valeur);
```

pour r√©cup√©rer des informations, on fournit la cl√©

```php
$session->get("cle_unique");
```

## redirection

Quand on a pas d'affichage √† faire, on peut rediriger notre utilisateur vers une route qui va faire un affichage.

Dans le cadre de formulaire qui ajoute des donn√©es, cette redirection sera obligatoire.

```php
$this->redirectToRoute('nom_de_la_route', ["parametre_route" => $valeurParam√®tre]);
```

Cela envoit un code HTTP `302` que le navigateur va comprendre et il va r√©cup√©rer l'URL de la route, pour automatiquement refaire une nouvelle requete vers notre serveur.

## SQL

[exo](https://sqlbolt.com/lesson/select_queries_introduction)

[exo oclock](http://cluedo.oclock.lan/)

[exo cluedo US](https://mystery.knightlab.com/)

### SELECT

```sql
SELECT * FROM movies;
SELECT title FROM movies;
```

### WHERE

```sql
SELECT * FROM movies WHERE id = 6;
SELECT * FROM movies WHERE `year` BETWEEN 2000 AND 2010;
SELECT title, `year` FROM movies WHERE `year` <= 2003;
```

```sql
SELECT * FROM movies WHERE title like '%Toy Story%';
SELECT * FROM movies WHERE director != 'John Lasseter';
SELECT * FROM movies WHERE title LIKE "WALL-_";
```


```sql
SELECT DISTINCT director FROM movies ORDER BY director;
SELECT *
FROM movies
ORDER BY `year` DESC
LIMIT 4;

SELECT *
FROM movies
ORDER BY id
LIMIT 5 OFFSET 5; -- LIMIT 5,5 avec Mysql
```

```sql
SELECT * FROM north_american_cities
WHERE country = 'United States'
ORDER BY Population DESC
LIMIT 2, 2;
```

[sql.sh jointure schema](https://sql.sh/2401-sql-join-infographie)

```sql
SELECT * FROM movies, Boxoffice WHERE movies.id = Boxoffice.movie_id;
SELECT * FROM movies INNER JOIN Boxoffice ON movies.id = Boxoffice.movie_id;
SELECT movies.*, Boxoffice.* FROM movies
INNER JOIN Boxoffice ON movies.id = Boxoffice.movie_id
WHERE Boxoffice.International_sales > Boxoffice.Domestic_sales;
```

```sql
SELECT DISTINCT buildings.building_name, employees.role 
-- TABLE A : buildings
-- TABLE B : employees
FROM buildings
  LEFT JOIN employees
    ON buildings.building_name = employees.building;
```

## m√©thode Merise

### Mod√®le Conceptuel de Donn√©e : MCD

Les objectifs de ce sch√©ma

* communiquer avec notre client
* d√©finir les tables (entit√©s)
  * d√©finir les champs qui composent l'entit√©
* d√©finir les relations entre les entit√©s
  * donner 2 cardinalit√©s
  * chaque cardinalit√©s a
    * une valeur minimale : 0/1
    * une valeur maximale : 1/N
  * dans une relation il peut y avoir des informations suppl√©mentaires
    * c'est informations seront stock√©es dans une entit√© qui apparaitra dans le MLD

[outils en ligne](https://www.mocodo.net/)

Pas de type de donn√©e : le Mod√®le Physique va le faire

Pas terme technique : ce sch√©ma est destin√©e au client / non-technicien
Donc pas d'ID (**pas au TP**), c'est technique un ID
Par contre on a besoin d'un code unique:

* en france, le num√©ro de s√©curit√© sociale
* livre : ISBN International Standard Book Number ‚Äì ou Num√©ro international normalis√© du livre
* audiovisuel : ISAN International Standard Audiovisual Number, abr√©g√© par le sigle ISAN, litt√©ralement ¬´ num√©ro international normalis√© des ≈ìuvres audiovisuelles ¬ª
* Un GUID est un entier 128 bits (16 octets) qui peut √™tre utilis√© sur tous les ordinateurs et r√©seaux o√π un identificateur unique est requis.
* [wikipedia](https://en.wikipedia.org/wiki/Unique_identifier)

#### cardinalit√©s

Un film poss√®de 0 ou plusieurs (N) saison
Une saison appartient √† 1 et 1 seul film
MOVIE 0N <-- BELONGS TO --> 11 SEASON

Un film poss√®de 0 ou plusieurs (N) genre
un genre poss√®de 0 ou plusieurs (N) film
MOVIE 0N <-- BELONGS TO --> 0N GENRE

On peut cr√©er plein de genre dans la base
Et ne pas avoir de film associ√© √† ce genre d√®s le d√©but

On peut cr√©er plein de film dans la base
Et ne pas avoir de genre associ√© √† ce film d√®s le d√©but

Tips : si dans une relation, la cardinalit√© minimale est √† 1 elle est obligatoire
Cela peut nous g√©ner dans nos developpement.
Dans le doute, mettre 0.
Si on se pose la question sur une cardinalit√© mini, m√™me chose, 0 par d√©faut

### Mod√®le Logique de Donn√©e : MLD

l'objectif de cette √©tape (ce n'est pas un sch√©ma) et de cr√©er:

* les cl√©s √©trang√®res
* les tables pivot

Dans le MCD, on a d√©finit des cl√©s Primaires (les codes de chaque table)
Avec nos relations on a besoin de noter les relations dans les donn√©es.
ex : 1 saison appartient √† 1 film

j'ai un moyen mn√©motechnique de me souvenir comment on cr√©er les cl√© √©trang√®res.

Toutes les cl√©s primaires voyagent ‚úà et elles veulent aller dans les plus d'autre pays (tables) possible.
Sur une relation, uniquement la cl√© primaire qui a le plus d'argent (cardinalit√© max) voyage.
Donc les cl√©s primaires voyagent depuis la table avec la cardinalit√© maximum N vers l'autre table.

La cl√© primaire de `Movie` voyage donc vers la table `Season`, et devient une cl√© √©trang√®re dans cette table.

Mais comment on fait quand il y a une cardinalit√© max N de chaque cot√© ü§î ?

Repronnons l'id√©e du voyage :

les 2 cl√©s primaires voyagent, se rencontrent sur le chemin, tombent amoureuses üíò, et fondent une nouvelle table, et il eurent plein de petite cl√©s. Awwwn ü§ó

On appele cette nouvelle table une table `pivot`

### Mod√®le Physique de Donn√©e : MPD

L'objectif de ce sch√©ma, et de pr√©parer la cr√©ation de la BDD.

C'est √† ce moment que l'on choisit notre moteur de base de donn√©es.
C'est √† ce moment que l'on d√©cide des types de donn√©es [sql.sh](https://sql.sh/416-limites-types-donnees-sgbd)

C'est √† ce moment que l'on fixe les ID

Dans la vrai vie, ce sch√©ma est g√©n√©r√© par des outils qui se connecte √† la BDD (phpmyadmin, adminer)